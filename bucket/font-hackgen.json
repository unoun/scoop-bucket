{
    "version": "2.6.3",
    "description": "Japanese font based on Hack and GenJyuu-Gothic",
    "homepage": "https://github.com/yuru7/HackGen",
    "license": "OFL-1.1-RFN",
    "url": "https://github.com/yuru7/HackGen/releases/download/v2.6.3/HackGen_v2.6.3.zip",
    "hash": "2b1c751abe318c44e2a3b22137fa31c18765a1c4e07962a8d1e05e7d5908241a",
    "depends": "sudo",
    "installer": {
        "script": [
            "function Get-FontName([System.IO.FileInfo] $file) {",
            "    $job = Start-Job -ScriptBlock {",
            "        Add-Type -AssemblyName PresentationCore",
            "        $font = [Windows.Media.GlyphTypeface]::new($using:file.FullName)",
            "        return \"$($font.Win32FamilyNames['en-US']) $($font.Win32FaceNames['en-US']) (TrueType)\"",
            "    }",
            "    Wait-Job -Job $job | Out-Null",
            "    $ret = Receive-Job $job",
            "    Remove-Job $job",
            "    return $ret",
            "}",
            "$fontsDir = \"$env:LOCALAPPDATA\\Microsoft\\Windows\\Fonts\"",
            "$regPath = \"HKCU:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Fonts\"",
            "New-Item $fontsDir -ItemType Directory -ErrorAction SilentlyContinue",
            "Get-ChildItem $dir -Filter \"*.ttf\" -Recurse | ForEach-Object {",
            "    $fontName = Get-FontName($_)",
            "    info \"Installing font $($_.Name) -> $fontName\"",
            "    Copy-Item $_.FullName -Destination $fontsDir",
            "    New-ItemProperty -Path $regPath -Name $fontName -Value \"$fontsDir\\$($_.Name)\" -Force | Out-Null",
            "}"
        ]
    },
    "uninstaller": {
        "script": [
            "if (!(is_admin)) { error \"Use sudo\"; exit 1 }",
            "function Get-FontName([System.IO.FileInfo] $file) {",
            "    $job = Start-Job -ScriptBlock {",
            "        Add-Type -AssemblyName PresentationCore",
            "        $font = [Windows.Media.GlyphTypeface]::new($using:file.FullName)",
            "        return \"$($font.Win32FamilyNames['en-US']) $($font.Win32FaceNames['en-US']) (TrueType)\"",
            "    }",
            "    Wait-Job -Job $job | Out-Null",
            "    $ret = Receive-Job $job",
            "    Remove-Job $job",
            "    return $ret",
            "}",
            "$fontsDir = \"$env:LOCALAPPDATA\\Microsoft\\Windows\\Fonts\"",
            "$regPath = \"HKCU:\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Fonts\"",
            "Get-ChildItem $dir -Filter \"*.ttf\" -Recurse | ForEach-Object {",
            "    $fontName = Get-FontName($_)",
            "    info \"Uninstalling font $($_.Name) -> $fontName\"",
            "    Remove-ItemProperty -Path $regPath -Name $fontName -ErrorAction SilentlyContinue",
            "}",
            "if ((Get-Service 'FontCache').Status -eq 'Running') {",
            "    info \"Restart FontCache service\"",
            "    Restart-Service FontCache",
            "}",
            "Get-ChildItem $dir -Filter \"*.ttf\" -Recurse | ForEach-Object {",
            "    $fontFile = \"$fontsDir\\$($_.Name)\"",
            "    Remove-Item $fontFile -ErrorAction SilentlyContinue",
            "    if (Test-Path $fontFile) {",
            "        warn \"Couldn't remove '$fontFile'; it may be in use.\"",
            "    }",
            "}"
        ]
    }
}